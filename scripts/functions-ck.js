$(function(){var e=Backbone.Model.extend(),t=Backbone.Collection.extend({initialize:function(){this.sort_key="order"},comparator:function(e,t){e=e.get(this.sort_key);t=t.get(this.sort_key);return e>t?1:e<t?-1:0},model:e,filterBy:function(e){var n;if(e.indexOf("|")>0){var r=e.split("|");n=this.filter(function(e){for(var t=0;t<e.get("services").length;t++){var n=e.get("services")[t].toString();if(n&&r.indexOf(n.toLowerCase())>-1)return!0}})}else n=this.filter(function(t){for(var n=0;n<t.get("services").length;n++){var r=t.get("services")[n].toString();if(r&&r.toLowerCase()===e)return!0}});return new t(n)},sortBy:function(e,t){this.sort_key=e;this.sort();t=="desc"&&(this.models=this.models.reverse());return this}}),n=Backbone.View.extend({tagName:"ul",render:function(){_.each(this.model.models,function(e){$(this.el).append((new r({model:e})).render().el)},this);return this}}),r=Backbone.View.extend({tagName:"li",template:_.template($("#template-portfolio").html()),render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}}),i=Backbone.View.extend({template:_.template($("#template-filter").html()),initialize:function(){this.filterValue="";this.sortKey="";this.sortOrder=""},render:function(){var e=this.sortKey;this.sortOrder&&(e+="/"+this.sortOrder);$(this.el).html(this.template({sortValue:e,filterValue:this.filterValue}));return this},events:{"change .filter":"changeList","change #sort":"changeList"},changeList:function(){var e=this.getFilter(),t=this.getSort(),n="";e&&(n+="filter/"+e);if(t){e&&(n+="/");n+="sort/"+t}o.navigate(n,!0)},getSort:function(){var e=$("#sort").val();return e},getFilter:function(){if($(".filter:checked").size()>0){var e=new Array;$(".filter:checked").each(function(t){e.push($(this).val())});return e.join("|")}return""}}),s=Backbone.Router.extend({initialize:function(){this.portfolio=new t(portfolioList);this.sortKey="order";this.sortOrder="asc"},routes:{"":"list","filter/:filter(/sort)(/:sortKey)(/:sortOrder)":"filter","sort/:sortBy(/:value)":"sort"},list:function(){this.portfolioView=new n({model:this.portfolio});$("#portfolio").html(this.portfolioView.render().el);this.filterView=new i;$("#filter").html(this.filterView.render().el)},filter:function(e,t,r){if(!t){t=this.sortKey;r||(r=this.sortOrder)}this.portfolioView=new n({model:this.portfolio.filterBy(e).sortBy(t,r)});$("#portfolio").html(this.portfolioView.render().el);this.filterView=new i;this.filterView.sortOrder=r;this.filterView.sortKey=t;this.filterView.filterValue=e;$("#filter").html(this.filterView.render().el)},sort:function(e,t){t||(t="");this.portfolioView=new n({model:this.portfolio.sortBy(e,t)});$("#portfolio").html(this.portfolioView.render().el);this.filterView=new i;this.filterView.sortOrder=t;this.filterView.sortKey=e;$("#filter").html(this.filterView.render().el)}}),o=new s;Backbone.history.start()});